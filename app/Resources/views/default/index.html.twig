{% form_theme form 'bootstrap_3_layout.html.twig' %}
{% extends 'base.html.twig' %}
{% block body %}
    <div id="wrapper">
        <div id="container">
            <div id="welcome">
                <h1><span>Newsletter participative<br>de Nuit Debout <sup>beta</sup></span></h1>
            </div>
            <div id="next">
            <p class="bg-info">
                Cet outil est en cours de développement.<br>
                Suggestions, impressions, bugs : <a href="https://pad.bombastus.duckdns.org/OwMwTAzARiDGAMBaMsCcAORAWMBTJU8YIi6u5AjPFLAGwUxA" target="_blank">écrivez sur ce document</a>
                </p>
            </div>

            <div id="next">
                <h2>Proposez vos articles</h2>
                <div id="cadre">
                    <div class="obligatoire btn-ajout">(*) = champ obligatoire</div>
                    <form id="formProposition" class="form-group" action="#" method="post" name="proposition" {{ form_enctype(form) }}>
                        
                        {{ form_errors(form) }}
                        {{ form_row (form._token) }}

                       <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-4">{{ form_row(form.typeProposition) }}</div>
                              <div class="col-md-8">{{ form_row(form.title) }}</div>
                            </div>
                        </div>

                        <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-12">{{ form_row(form.teaser) }}</div>
                            </div>  
                        </div>

                        <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-12">{{ form_row(form.url) }}</div>
                            </div>  
                        </div>
                        
                        <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-4">{{ form_row(form.lieu) }}</div>
                              <div class="col-md-4">{{ form_row(form.theme) }}</div>
                              <div class="col-md-4">{{ form_row(form.deadline) }}</div>
                            </div>
                        </div>

                        <div class="container-fluid">
                            <div class="row">
                              <div class="col-md-12">
                                    {{ form_row(form.description) }}

                                    <div id="ajoutDoc"><IMG class="imagePlus" src="{{ asset('bundles/app/images/plus.png') }}" alt="ajout document" /> Cliquer ici pour ajouter des documents</div>

                                    <div class="form-document">
                                        <div class="cadre-upload">{{ form_row(form.documents) }}</div>
                                    </div>

                                    <input type="submit" value="Enregistrez" class="btn btn-primary btn-lg">
                            </div>
                            </div>
                        </div>

                        
                    </form>
                    <script type="text/javascript">

                        $(document).ready(function() {

                            // On récupère la balise <div> en question qui contient l'attribut « data-prototype » qui nous intéresse.
                            var $container = $('div#form_documents');

                            // On ajoute un lien pour ajouter une nouvelle catégorie
                            var $lienAjout = $('<p class="btn btn-warning btn-ajout"><a href="#" id="ajout_document">+ Ajouter un autre document</a></p>');
                            $container.append($lienAjout);

                            // On ajoute un nouveau champ à chaque clic sur le lien d'ajout.
                            $lienAjout.click(function(e) {
                                ajouterDocument($container);
                                e.preventDefault(); // évite qu'un # apparaisse dans l'URL
                                return false;
                            });
                            // La fonction qui ajoute un formulaire Document
                            function ajouterDocument($container) {
                                // Dans le contenu de l'attribut « data-prototype », on remplace :
                                // - le texte "__name__label__" qu'il contient par le label du champ
                                // - le texte "__name__" qu'il contient par le numéro du champ
                                var $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, 'Document n°' + (index+1))
                                        .replace(/__name__/g, index)
                                        .replace('class="required"', 'class="labelDoc"'));

                                // On ajoute au prototype un lien pour pouvoir supprimer la catégorie
                                ajouterLienSuppression($prototype);

                                // On ajoute le prototype modifié à la fin de la balise <div>
                                $container.append($prototype);

                                // Enfin, on incrémente le compteur pour que le prochain ajout se fasse avec un autre numéro
                                index++;
                            }

                            // On définit un compteur unique pour nommer les champs qu'on va ajouter dynamiquement
                            var index = $container.find(':input').length;

                            // On ajoute un premier champ directement s'il n'en existe pas déjà un (cas d'un nouvel article par exemple).
                            if (index == 0) {
                                ajouterDocument($container);
                            } else {
                                // Pour chaque catégorie déjà existante, on ajoute un lien de suppression
                                $container.children('div').each(function() {
                                    ajouterLienSuppression($(this));
                                });
                            }
                        

                            // La fonction qui ajoute un lien de suppression d'une catégorie
                            function ajouterLienSuppression($prototype) {
                                // Création du lien
                                $lienSuppression = $('<p class="btn btn-danger"><a href="#">Supprimer</a></p>');

                                // Ajout du lien
                                $prototype.append($lienSuppression);

                                // Ajout du listener sur le clic du lien
                                $lienSuppression.click(function(e) {
                                    $prototype.remove();
                                    e.preventDefault(); // évite qu'un # apparaisse dans l'URL
                                    return false;
                                });
                            }



                        });
                    </script>
                </div>
            </div>
            <div id="next">
            <h2>Votez pour organiser les contenus</h2>
                <h4>Prochaine Newsletter (envoi prévu le 1er décembre 2016)</h4>
                <p><a href="#">Voir la newsletter précedente</a> </p>


                {% if arrayProposition|length > 0 %}
                    {% for key, item in arrayProposition %}

                        {% set cheminDoc = "" %}
                        {% set break = false %}
                        {% for document in item.getDocuments if not break %}
                            {% set ext = document.getWebDoc|split('.') %}
                            {% if ext[1] == "jpeg" or ext[1] == "png" %}
                                {% set cheminDoc = document.getWebDoc %}
                                {% set break = true %}
                            {% endif %}
                        {% endfor %}

                        <div id="cadre">
                            <div>Position : {{ key + 1 }}</div>
                            <div id="imgPres"><img src="{% if cheminDoc != "" %}{{ asset(cheminDoc) }}{% else %}{{ asset('bundles/app/images/pasimage.png') }}{% endif %}"></div>
                            <div>{{ item.getTitle }}</div>
                            <div>{{ item.getTeaser }}</div>
                            <div><a href="{{ item.getUrl }}" target="_blank">Lien</a></div>
                            <div>{{ item.getTheme }}</div>
                            {% if item.getDescription|length > 0 %}
                                {% set idDesc = 'desc' ~ key %}
                                <div id='{{ idDesc }}_sp' onclick='admin.afficheDesc("{{ idDesc }}")'><p >En savoir plus</p></div>
                                <div id="{{ idDesc }}" style="display: none"><p>{{  item.getDescription|raw }}</p></div>
                                <div id='{{ idDesc }}_r' onclick='admin.cacheDesc("{{ idDesc }}")' style="display: none"><p >Réduire</p></div>
                            {% endif %}
                            <div id="imgAction">
                                <a href="{{ path('proposition_monte', {'id': item.getId}) }}"><img src="{{ asset('bundles/app/images/monte.png') }}"></a>
                                <a href="{{ path('proposition_descend', {'id': item.getId}) }}"><img src="{{ asset('bundles/app/images/descend.png') }}"></a>
                                <a href="{{ path('proposition_interdit', {'id': item.getId}) }}"><img src="{{ asset('bundles/app/images/interdit.png') }}"></a>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}

             </div>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
<style>
    body { background: #F5F5F5; font: 18px/1.5 sans-serif; }
    h1, h2 { line-height: 1.2; margin: 0 0 .5em; }
    h1 { font-size: 36px; }
    h2 { font-size: 21px !important; margin-bottom: 1em; }
    h2 {
    text-transform: uppercase;
    font-size: 24px !important;
    text-align: center;
    }
    h4 {text-align: center;}
    p { margin: 0 0 1em 0; }
    a { color: #0000F0; }
    a:hover { text-decoration: none; }
    code { background: #F5F5F5; max-width: 100px; padding: 2px 6px; word-wrap: break-word; }
    #wrapper { background: #FFF; margin: 1em auto; max-width: 800px; width: 95%; }
    #container { padding: 2em; }
    #cadre { border: 1px solid #ccc;
    border-radius: 8px;}
    #welcome, #status { margin-bottom: 2em; }
    #welcome h1 span {
    display: block;
    font-size: 75%;
    text-transform: uppercase;
    letter-spacing: 4px;
    }

     #welcome h1 span sup {
color: #fdc9e0;
    font-size: 50%;
     }
    #icon-status, #icon-book { float: left; height: 64px; margin-right: 1em; margin-top: -4px; width: 64px; }
    #icon-book { display: none; }
    #imgAction img {width: 40px; height: 40px;}
    #imgPres img {width: 240px; height: 140px;}

    @media (min-width: 768px) {
        #wrapper { width: 80%; margin: 2em auto; }
        #icon-book { display: inline-block; }
        /* #status a, #next a { display: block; } */

        @-webkit-keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        .sf-toolbar { opacity: 0; -webkit-animation: fade-in 1s .2s forwards; animation: fade-in 1s .2s forwards;}
    }

    .cke_reset {
    margin: 0 !important;
    }

    .obligatoire {color:#ccc; text-align:center;}
    .obligatoire sup {font-size:130%; color:#324534;}

.control-label {
    background: #9a9c92;
    color: #fff;
    border-radius: 4px;
    padding: 4px 7px;
    font-size: 86%;
    width: 100%;
    text-align: center;
    text-transform: uppercase;
}

.required {
    background: #a2b947;
}
.bg-info {
    background-color: #c9fddc !important;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}



#form_documents {
    border: 1px solid #ddd;
    padding: 10px;
}

.btn-primary {
    text-align: center;
    width: 100%;
}

    .btn{
        border: 1px solid #ccc;
        border-radius: 6px;
        text-align: center;
        top: 10px;
    }

    .btn a {
        top: 10px;
        color: #FFF;
        font-weight: bold;
        font-size: 12px;

    }

    .btn-danger{
    color: #fff !important;
    background-color: #e07774;
    border-color: #b96360;
    width: 100%;
}
.btn-ajout {

    margin: 10px;
}

    #ajoutDoc{
        text-align: center;
        font-size: 16px;
        margin: 43px auto;
    }

    .imagePlus{
        height: 30px;
        width: 30px;
    }

    .ui-datepicker-trigger{
        height: 30px;
        width: 30px;
    }

    .cadre-form{
        border: 1px solid #efc100;
        width: 841px;
    }

   .cadre-upload {

    border: 0;
    width: 100%;
}
#form_documents {
padding: 0 10px;
}

    #form_documents label{
        width: 100%;
    }

    #form_documents .labelDoc{
        margin-left: -61px;
        width: 15em;
    }

    .form-control:focus {
    border-color: #3ac170 !important;
    outline: 0;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(202, 152, 198, 0.6);
    box-shadow: inset 0 1px 1px #cafdd7,0 0 8px rgba(109, 28, 110, 0.35);
    }

</style>
{% endblock %}
